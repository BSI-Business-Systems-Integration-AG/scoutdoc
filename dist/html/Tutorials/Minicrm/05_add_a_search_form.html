<?xml version='1.0' encoding='utf-8' ?><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><table border="0" class="navigation" style="width: 100%;" summary="navigation"><tr><th align="center" colspan="3" rowspan="1" style="width: 100%;">Add a search form</th></tr><tr><td align="left" colspan="1" rowspan="1" style="width: 20%"><a href="04_write_the_first_page.html" shape="rect" title="Write the first page"><img alt="Previous" border="0" src="../../Images/prev.gif"></img></a></td><td align="center" colspan="1" rowspan="1" style="width: 60%"></td><td align="right" colspan="1" rowspan="1" style="width: 20%"><a href="06_add_a_form_to_edit_the_data.html" shape="rect" title="Add a form to edit the data"><img alt="Next" border="0" src="../../Images/next.gif"></img></a></td></tr><tr><td align="left" colspan="1" rowspan="1" style="width: 20%">Write the first page</td><td align="center" colspan="1" rowspan="1" style="width: 60%"></td><td align="right" colspan="1" rowspan="1" style="width: 20%">Add a form to edit the data</td></tr></table><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Scout Tutorial</b><br/>This page belongs to the <a href="index.html" title="Scout/Tutorial/3.8/Minicrm_Step-by-Step">Minicrm Step-by-Step Tutorial</a>. It explains how to add a search form to a table page. You need to <a href="04_write_the_first_page.html" title="Scout/Tutorial/3.8/Minicrm/Write the first page">have a table page in your application</a> in order to continue.</div>
</div></p><p>Once we have <b>created a table page</b> and <b>implemented the service</b> to get the table data, we can take advantage of a feature the Scout SDK offers: it can <b>create a search form</b> based on the existing information.</p><p>The alternative, of course, is to create the search form manually.</p><p>Once you have all that, it's time to <a href="06_add_a_form_to_edit_the_data.html" title="Scout/Tutorial/3.8/Minicrm/Add_a_form_to_edit_the_data">add a form to edit the data</a>.</p><h2 id="What_are_we_talking_about.3F">What are we talking about?</h2><p>We need to create a <b>search form</b> that will be shown together with our newly created <b>table page</b>. The values provided by the user (i.e. the chosen search criteria) are packed into a <b>FormData</b> object, which is passed along to the <b>outline service</b>. There, we need to build an appropriate <tt>WHERE</tt> clause.</p><p><img width="900" border="0" src="../../Images/Scout_Search_Form_Details.png"/></p><h2 id="Create_a_Search_Form">Create a Search Form</h2><p>Go to the <i>CompanyTablePage</i>, right-click and choose <b>Create Search Form</b>. The created search form contains a field for each column defined on the base table page.</p><p><img border="0" src="../../Images/Scout-CreateSearchForm.PNG"/></p><p>Use <i>Company</i> as the name and click <i>Finish</i>.</p><p><img border="0" src="../../Images/Newsearchformwizard.jpg"/></p><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Form Data</b><br/>When creating a <i>form</i>, Scout SDK will automatically create a <i>form data</i> class in the background. The <i>form data</i> class will be created in the <b>shared</b> plugin. This is the data transfer object used for communication between client and server. The <i>form data</i> is automatically updated by the Scout SDK when the corresponding form changes.</div>
</div></p><p>Done! What did Scout SDK do?</p><ol><li>it created a <b>CompanySearchForm</b> in the client plugin</li><li>it created a <b>CompanySearchFormData</b> in the shared plugin</li><li>it set the <b>Search Form property</b> of the <i>CompanyTablePage</i> to <i>CompanySearchForm</i></li></ol><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>How does it work?</b><br/>The Scout runtime will create the <i>search form</i> when showing the <i>company table page</i>. Using the search form will generate a <i>SearchFilter</i> object that is  passed on to the <tt>execLoadTableData</tt> method of the <i>table page</i>. The search filter contains the <i>form data</i> of the <i>SearchForm</i>.</div>
</div></p><h2 id="Adding_Fields">Adding Fields</h2><p>For each non-primarykey-column there has already been generated a field for you in the search form. <b>This is already enough to show a ''search form</b>''</p><p>If you want to add fields to a search form, expand your searchform like on the picture below and right click on <i>FieldBox (Search Criteria)</i> and pick <b>New Form Field...</b> from the menu.</p><p><img border="0" src="../../Images/Scout_New_Form_Field.png"/></p><p>Pick <b>String Field</b> from the list and click <i>Next</i>. Set the name to the desired name and click <i>Finish</i>.</p><p><img border="0" src="../../Images/Scout_New_String_Form_Field.png"/></p><p><img width="600" border="0" src="../../Images/Scout_Minicrm_With_Search_Form.png"/></p><p>There is one missing piece, obviously. The service that gets the actual data needs to build some sort of constraint (a WHERE clause to the SQL statement) to filter the returned rows.</p><h2 id="Adapt_the_outline_service_operation_getCompanyTableData">Adapt the outline service operation getCompanyTableData</h2><p>In order to constrain the SQL statement for the company outline, we have to adapt the service operation <i>getCompanyTableData</i> and add a parameter <i>searchFilter</i> of the type <i>CompanySearchFormData</i> to the method. Do that for both the service interface <i>IStandardOutlineService</i> and the service implementation <i>StandardOutlineService</i>. There are two easy ways to find them: Ctrl+Shift+T, or find the <i>StandardOutlineService</i> on the server side in the <i>Scout Perspective</i> and click on the two links.</p><p>Interface:</p><pre class="source-java">public interface IStandardOutlineService extends IService {
  public Object[][] getCompanyTableData (CompanySearchFormData formData) throws ProcessingException;
}

</pre><p>Implementation:</p><pre class="source-java">public Object[][] getCompanyTableData(CompanySearchFormData formData) throws ProcessingException {
  StringBuilder statement = new StringBuilder();
  statement.append(
      "SELECT COMPANY_NR, SHORT_NAME, NAME " +
	  "FROM   COMPANY " +
	  "WHERE  1=1 ");
  if (!StringUtility.isNullOrEmpty(formData.getShortName().getValue())) {
    statement.append("AND UPPER(SHORT_NAME) LIKE UPPER(:shortName || '%') ");
  }
  if (!StringUtility.isNullOrEmpty(formData.getName().getValue())) {
    statement.append("AND UPPER(NAME) LIKE UPPER(:name || '%')");
  }
  return SQL.select(statement.toString(), formData);
}

</pre><p><b>Prefixing of names with a colon</b> automatically makes these instances <b>bind variables</b>. The Scout runtime will bind these <i>bind variables</i> to the corresponding fields from the <i>form data</i> object.</p><p><div class="messagebox " style="background-color: #f9f6b7; border: 1px solid #c4c295; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Warning2.png"/></div>
<div><b>Naming Convention</b><br/>We're relying on a naming convention, here! If your form has a field called <b>ShortName</b>, then the bind variable will be called <b>:shortName</b>. Note the capitalization.</div>
</div></p><p>Now we need to forward the <i>CompanySearchFormData</i> to the server. Return to the method <b>execLoadTableData</b> in the <b>CompanyTablePage</b> and add a new parameter to the service call according to its interface definition. The required <i>CompanySearchFormData</i> is available from the <i>filter</i> parameter:</p><pre class="source-java">@Override
protected Object[][] execLoadTableData(SearchFilter filter) throws ProcessingException {
  return SERVICES.getService(IStandardOutlineService.class).getCompanyTableData((CompanySearchFormData) filter.getFormData());
}

</pre><p>If the search is inactivated with <code>setSearchActive(false);</code>, the method call <code>filter.getFormData()</code> returns <tt>null</tt>. Therefore, it can be interesting to do this check on client side and to send an empty formData (corresponding to a search request without any constraints).</p><pre class="source-java">@Override
protected Object[][] execLoadTableData(SearchFilter filter) throws ProcessingException {
  CompanySearchFormData formData = (CompanySearchFormData) filter.getFormData();
  if(formData == null) {
    formData = new CompanySearchFormData();
  }
  return SERVICES.getService(IStandardOutlineService.class).getCompanyTableData(formData);
}

</pre><p><b>Enjoy!</b></p><p><img width="600" border="0" src="../../Images/Scout_Minicrm_With_Two_Search_Fields.png"/></p><table border="0" class="navigation" style="width: 100%;" summary="navigation"><tr><td align="left" colspan="1" rowspan="1" style="width: 20%"><a href="04_write_the_first_page.html" shape="rect" title="Write the first page"><img alt="Previous" border="0" src="../../Images/prev.gif"></img></a></td><td align="center" colspan="1" rowspan="1" style="width: 60%"><a href="index.html" shape="rect" title="Mini CRM Scout application"><img alt="Mini CRM Scout application" border="0" src="../../Images/home.gif"></img></a></td><td align="right" colspan="1" rowspan="1" style="width: 20%"><a href="06_add_a_form_to_edit_the_data.html" shape="rect" title="Add a form to edit the data"><img alt="Next" border="0" src="../../Images/next.gif"></img></a></td></tr><tr><td align="left" colspan="1" rowspan="1" style="width: 20%">Write the first page</td><td align="center" colspan="1" rowspan="1" style="width: 60%"></td><td align="right" colspan="1" rowspan="1" style="width: 20%">Add a form to edit the data</td></tr></table></body></html>
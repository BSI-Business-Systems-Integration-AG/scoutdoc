<?xml version='1.0' encoding='utf-8' ?><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><table border="0" class="navigation" style="width: 100%;" summary="navigation"><tr><th align="center" colspan="3" rowspan="1" style="width: 100%;">Write the first page</th></tr><tr><td align="left" colspan="1" rowspan="1" style="width: 20%"><a href="03_set_up_sql_service.html" shape="rect" title="Set up SQL Service"><img alt="Previous" border="0" src="../../Images/prev.gif"></img></a></td><td align="center" colspan="1" rowspan="1" style="width: 60%"></td><td align="right" colspan="1" rowspan="1" style="width: 20%"><a href="05_add_a_search_form.html" shape="rect" title="Add a search form"><img alt="Next" border="0" src="../../Images/next.gif"></img></a></td></tr><tr><td align="left" colspan="1" rowspan="1" style="width: 20%">Set up SQL Service</td><td align="center" colspan="1" rowspan="1" style="width: 60%"></td><td align="right" colspan="1" rowspan="1" style="width: 20%">Add a search form</td></tr></table><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Scout Tutorial</b><br/>This page belongs to the <a href="http://wiki.eclipse.org/Scout/Tutorial/3.8/Minicrm_Step-by-Step" title="Scout/Tutorial/3.8/Minicrm_Step-by-Step" target="doc_external">Minicrm Step-by-Step Tutorial</a>. It explains how to create your first page in your project and fill it with data from the database. You need to <a href="03_set_up_sql_service.html" title="Scout/Tutorial/3.8/Minicrm/Set up SQL Service">connect a database to your application</a> in order to continue.</div>
</div></p><p>A typical Eclipse Scout application consists of multiple <b>outlines</b>. Think of it as a folder hierarchy. Each "folder" is called a <b>page</b>. These pages come <b>with nodes</b> (a list of child pages) or <b>with a table</b> (a table filled with rows of data from a data source such as a database). The <b>table</b> has named <b>columns</b>. We need to create models for all of these.</p><p>If we want to fill the tables with data, we need to create a <b>service</b> on the server side. This service will get data from the database and return <i>tabular data</i>: data arranged in rows and columns which we can use to fill the tables we created on the client side.</p><p>Once we have all that we're ready to <a href="05_add_a_search_form.html" title="Scout/Tutorial/3.8/Minicrm/Add_a_search_form">add a search form</a> to our application.</p><h2 id="What_are_we_talking_about.3F">What are we talking about?</h2><p>When we talk about <i>outlines</i> and <i>pages</i>, think of a simple application. In this tutorial we're creating a miniature CRM. Here's what it may look like, using the Eclipse Scout terminology:</p><ol><li>one outline for companies and persons<ol><li>the companies page shows a table with rows from the company table on the database</li><li>the persons page shows a table with rows from the person table on the database</li><li>for every person there is a list of nodes naming all the child pages</li></ol></li><li>there may be other outlines for different tasks or topics, such as marketing campaigns</li></ol><p><img width="900" border="0" src="../../Images/Scout_Pages_and_Outlines.jpg"/></p><p>If you look at the diagram above, there are some interesting things to note.</p><ol><li>the outline itself acts like a page with nodes -- it just shows the titles of the child pages (persons and companies)</li><li>there can be only one child page for a page "with table" -- every row in the table has the same child</li><li>the title of a child page underneath a table is not shown -- by default the first visible column of the table replaces whatever the name was (in the example above "Catherine" replaces whatever the name of the Person Details Page was)</li></ol><p>In this tutorial, our <b>first page</b> will be the <b>company</b> table page. The <b>standard outline</b> is a prerequisite, so we'll start there.</p><p>All of these structures are strictly client-side structures. The <b>server</b> couldn't care less about how the various services it provides will get used. The only thing we need on the server side is <b>a service that returns tabular company data</b>.</p><h2 id="Add_a_Page_to_the_Outline">Add a Page to the Outline</h2><p>Add a new page to your StandardOutline. Right-click on the <i>Child Pages</i> node of your <i>StandardOutline</i> and then choose <i>New Page...</i>.</p><p><img border="0" src="../../Images/Scout-AddChildPage.PNG"/></p><p>From the dropdown list choose <b>AbstractPageWithTable</b>, then click next.</p><p><img border="0" src="../../Images/Scout-AddChildPage1.PNG"/></p><p>Now enter the name for the new table page: <i>Company</i>.</p><p>If there is no appropriate multilingual text, pick <i>New translated text...</i> from the list and provide a key and a default translation.</p><p><img border="0" src="../../Images/Scout-AddChildPage2.PNG"/></p><p><img border="0" src="../../Images/Scout-AddChildPage3.PNG"/></p><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Files Changed</b><br/>Creating a new translated text will create entries in different property files: <i>Texts.properties</i> for the default language, <i>Texts_de.properties</i> for German, and so on). You can find these property files in the <i>Java Perspective</i> under <i>eclipse.org.minicrm.shared/resources/texts</i>. </div>
</div></p><p>Eclipse Scout also comes with an editor to <b>edit all the property files for multilingual texts</b> in one go. If you expand the <i>shared</i> node in your Eclipse Scout project, expand <i>Text Provider Services</i> and click on <i>DefaultTextProviderService</i>. Click the  link in the Scout Object properties view.</p><p><img border="0" src="../../Images/Scout-NLS.PNG"/></p><p>Back to the <i>CompanyTablePage</i> example: pick <i>Company</i> from the list (create a new translated text if you haven't done so already) and click <i>Finish</i>.</p><p><img border="0" src="../../Images/Scout-AddChildPage4.PNG"/></p><p>When you now expand the <i>Child Pages</i> folder below your <i>StandardOutline</i>, you'll find the new <i>CompanyTablePage</i>. When you expand the node <i>Table</i>, you'll find a folder <i>Menus</i> and <i>Columns</i>. Below <i>Columns</i> we will now <b>add the columns</b> that are needed to display the company data.</p><p><img border="0" src="../../Images/Scout-AddChildPageCompany.PNG"/></p><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Files</b><br/>Creating the Company Table Page has created the file <i>eclipse.org.minicrm.client.ui.desktop.outlines.pages/CompanyTablePage.java</i> and it has added code to <i>eclipse.org.minicrm.client.ui.desktop.outlines/StandardOutline.java</i>. The newly created method <b>execCreateChildPages</b> in <i>StandardOutline</i> shows how child pages are instantiated and added to the list.</div>
</div></p><h2 id="Add_colums_to_the_table">Add colums to the table</h2><p>The next step is <b>adding columns to the table</b>. Add a column for the primary key (<i>CompanyNrColumn</i>), one for the company's short name (<i>ShortNameColumn</i>) and one for the company's name (<i>NameColumn</i>).</p><p>The context menu for creating a new table column is on the <i>Columns</i> node right below the page's table.</p><p><img border="0" src="../../Images/Scout-NewColumn.PNG"/></p><p>First you have to choose a <b>template</b> for your column. The template used depends on the <b>data type</b> of your data and the <b>format</b> you want to use when displaying it. Eclipse Scout will attempt to cast your data types appropriately.</p><p>Choose <i>Long Column</i> for the first column and <i>String Column</i> for the remaining columns.</p><p><img title="Columntemplate.jpg" alt="Columntemplate.jpg" border="0" src="../../Images/Columntemplate.jpg"/></p><p><i>CompanyNrColumn</i> is going to be an invisible column. Thus, it requires no name. Just provide the <i>Type Name</i>. The remaining columns get multilingual texts for their labels, just like everything else in an Eclipse Scout application.</p><p><img border="0" src="../../Images/Scout-NewColumn1.PNG"/></p><table style="border-top: 1px solid black; border-bottom: 1px solid black; margin: 1em; "><tr><th>Template</th><th>Name</th><th>TypeName</th><th>Width</th><th>Displayable</th></tr><tr><td>LongColumn</td><td>(none)</td><td>CompanyNrColumn</td><td>(irrelevant)</td><td>no</td></tr><tr><td>StringColumn</td><td>Short Name</td><td>ShortNameColumn</td><td>200</td><td>yes</td></tr><tr><td>StringColumn</td><td>Name</td><td>NameColumn</td><td>200</td><td>yes</td></tr></table><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Inner Classes</b><br/>A <b>page with table</b> is a single Java class. In this example, we're talking about the <b>CompanyTablePage</b>. The <b>table</b> itself is an <b>inner class</b> of the page. The <b>columns</b> are <b>inner classes</b> of the table. Take a look at the source files to see how it works. The Scout SDK parses the Java code in order to create its model, and the Scout runtime does the same thing. You'll also note that <b>annotations</b> such as <tt>@Order(30.0)</tt> are used to determine the order of columns in the table.</div>
</div></p><h2 id="Column_Width">Column Width</h2><p>If you restart your client, you will see that the table layout is <b>not optimal</b>.</p><p>The <b>column width</b> could be improved. The table has a property called <i>Auto resize columns</i> and every column has a property called <i>Width</i>. You can either specify a higher width for all of your columns or you can tell your table to auto resize all columns. When auto resizing, the available width is shared by all columns.</p><p><div class="messagebox " style="background-color: #f9f6b7; border: 1px solid #c4c295; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Warning2.png"/></div>
<div><b>Auto Resizing</b><br/>Generally speaking you should only use <i>auto resize columns</i> when <b>prototyping</b>. In a real application, most <b>numbers and dates should be in fixed width columns</b>. In addition to that, in some cases you will end up with a lot of columns. Twenty, thirty, and more columns are not unheard of. In this case, fixed columns width and (a lot of) horizontal scrolling is the only solution. Auto resized columns would result in an unreadable mess.</div>
</div></p><p>If you're not sure, use a width of 200 for text columns.</p><table><tr><td style="vertical-align:top"><img border="0" src="../../Images/Scout-ColumnWidth.PNG"/></td></tr></table><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Properties</b><br/>Setting properties in the Scout SDK needs to leave traces in the Java code because there is no other storage medium. If you look at the property view, you'll note that all the <b>bold</b> properties have non-default values. The property names act as links. They'll take you to the source code. Setting the width of a column to 200 results in a method being defined for the inner class modeling the column: <tt>protected int getConfiguredWidth() { return 200; }</tt>. This is how Scout properties are mapped: By overriding methods of the abstract classes the framework provides (such as <tt>AbstractStringColumn</tt> etc.).</div>
</div></p><h2 id="Hiding_Columns">Hiding Columns</h2><p>In addition to that, users are typically <b>not interested in primary keys</b>. You should hide <i>CompanyNrColumn</i> from the user.</p><p>You can do that by unticking the <b>Visible</b> property on the column. Users can make invisible columns visible, however. If you want to prevent this (and in this case you do), untick the <b>Displayable</b> property. To mark the column as a primary key you have to tick the <b>Primary Key</b> property.</p><p>Then it will look like this:
<img border="0" src="../../Images/Scout-NewColumn2.PNG"/></p><p>Note: There are only two columns</p><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Visible and Displayable Colums</b><br/>An invisible column is only invisible initially. Users can right-click on the column headers of a table and <i>organize</i> their columns. This is where users can show and hide columns, and this is where they can change their order. <b>Invisible columns can be made visible</b> using this dialog. If you want to prevent users from making invisible columns visible, you must make them <i>not displayable</i>.</div>
</div></p><p>Sometimes <b>invisible but displayable columns</b> are used if a certain table is used like a <i>report</i> for slightly different target users. Some users are interested in a certain subset of columns, other users are interested in a different subset. Instead of preparing a customized table for every target user, you can provide a single table for all users with specialized columns being invisible but displayable. Every user can then configure the visibility of the particular extra columns they are interested in.</p><h2 id="The_Flow_of_Data">The Flow of Data</h2><p>Now that we have our user interface, we need to think about <b>flow</b>: how does the data from the database get into our table? </p><p>Our table page has a method called <b>execLoadTableData</b>. We will override its default definition and call our <b>outline service</b> instead. In order to do this, we'll get a <b>proxy</b> from the service registry using the <tt>SERVICES</tt> object and the desired interface (<i>IStandardOutlineService.class</i>) as the key. We call the <b>getCompanyTableData</b> method on the proxy, it gets passed to the server, the method is called, the database is queried via the <b>SQL</b> object, the tabular data is returned to the proxy, it is returned to our function call, finally it will be used to populate the <i>CompanyTablePage</i> model. This in turn will be used to populate the user interface.</p><p><img width="900" border="0" src="../../Images/Scout_Table_Page_Data_Flow.png"/></p><h2 id="Create_an_new_service_operation_in_StandardOutlineService">Create an new service operation in StandardOutlineService</h2><p>In order to fill the table in our <i>CompanyTablePage</i> we need to have a <b>service</b> available on the server side. This service will contact the database and retrieve the data we need on the client.
The StandardOutlineService and the interface IStandardOutlineService has already been created.</p><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Service Types</b><br/>Services are grouped by <i>type</i> on the server side. <b>Outline</b> services are used by the pages "with table" in an outline. <b>Process</b> services are used by forms (dialogs). <b>Lookup</b> services are used by GUI items showing a list of values (smartfields, listboxes).</div>
</div></p><p>Now we need to add a service operation to the service.
To do so expand the node <i>Outline Services</i> and you'll see the <i>StandardOutlineService</i>. Right-click on it and choose <b>New Service operation</b>.</p><p><img border="0" src="../../Images/Scout-ServiceOperation.PNG"/></p><p>Choose <i>getCompanyTableData</i> as the name, and a two-dimensional object array <tt>Object[][]</tt> as the return type and click <i>Finish</i>. Now the operation will be added to the interface and the service itself.</p><p><img border="0" src="../../Images/Getcompanytabledata.jpg"/></p><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Object[][]</b><br/>Why aren't we using typed data to communicate between client and server? On the client side, we have a generic <i>load table data</i> method that needs to return <tt>Object[][]</tt>. It will call the service we just created. Thus, using <tt>Object[][]</tt> when sending tabular data from the server to the client is nothing but a <b>shortcut</b>.</div>
</div></p><p>When naming service operations that provide tabular data for use in table pages, following the pattern <b>get</b>Something'<i>TableData</i>' is a convention and considered good practice.</p><h2 id="Load_data_on_the_server">Load data on the server</h2><p>Open the implementation of <i>getCompanyTableData</i> either by expanding the node <i>StandardOutlineService</i> and double-clicking on <i>getCompanyTableData</i> or by opening the class <i>StandardOutlineService</i> directly (<i>Ctrl-Shift-T</i>) and scrolling down to <i>getCompanyTableData</i>. This is the place where we have to add an SQL statement which retrieves the data from the database.</p><p>The DB you've downloaded contains the following two tables:</p><p><img border="0" src="../../Images/Company.jpg"/></p><p><img border="0" src="../../Images/Person.jpg"/></p><p>As described in the <a href="http://wiki.eclipse.org/Scout_Overview" title="Scout Overview" target="doc_external">Scout Overview</a>, Eclipse Scout provides a base service called <tt>SQL</tt>. In order to access the database and select data, just call <tt>SQL.select(...)</tt>.</p><p>The first parameter to <tt>SQL.select</tt> is the <b>SELECT statement</b>.</p><pre class="source-java">public class StandardOutlineService extends AbstractService implements IStandardOutlineService {

  public Object[][] getCompanyTableData() throws ProcessingException {
    return SQL.select("" +
        "SELECT COMPANY_NR," +
        "       SHORT_NAME," +
        "       NAME" +
        " FROM  COMPANY");
  }
}

</pre><p><div class="messagebox " style="background-color: #f9f6b7; border: 1px solid #c4c295; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Warning2.png"/></div>
<div><b>Column order matters</b><br/>When writing your SELECT statement pay attention to specify the db columns in exactly the same order as the order of your table columns. This is necessarily so because we're just passing an untyped <tt>Object[][]</tt> along. This is an unfortunate consequence of the shortcut we used. As you can see, there are benefits (no packing and unpacking of the tabular data) and drawbacks (the compiler does not check types) to using an untyped <tt>Object[][]</tt>.</div>
</div></p><p>The optional, second parameter to <tt>SQL.select</tt> are the <b>Bind Bases</b>. They are needed if you need constraints (a WHERE clause with bind variables) in your SELECT statement. We have no need for them right now, since we're going to select <i>all</i> the companies.</p><h2 id="Display_data_on_the_client">Display data on the client</h2><p>The last thing to do now is to add the call to the <i>getCompanyTableData</i> service operation, for this we need to overwrite the method <i>AbstractPageWithTable.execLoadTableData(SearchFilter)</i>. Go back to your <i>CompanyTablePage</i>, in the lower part of the properties view click on the <i>+</i> right to <b>Exec Load Table Data</b> in order to create this method in your table page.</p><p><img border="0" src="../../Images/Scout-LoadTableData.PNG"/></p><p>Now you can use the convenience accessor class <b>SERVICES</b> to find the required service using the <i>IStandardOutlineService</i> interface class and call <i>getCompanyTableData</i> to load the data in your TablePage.</p><pre class="source-java">  @Override
  protected Object[][] execLoadTableData(SearchFilter filter) throws ProcessingException {
    return SERVICES.getService(IStandardOutlineService.class).getCompanyTableData();
  }

</pre><p><b>Restart your application</b></p><p><img border="0" src="../../Images/Scout-CompanyTablePage.PNG"/></p><table border="0" class="navigation" style="width: 100%;" summary="navigation"><tr><td align="left" colspan="1" rowspan="1" style="width: 20%"><a href="03_set_up_sql_service.html" shape="rect" title="Set up SQL Service"><img alt="Previous" border="0" src="../../Images/prev.gif"></img></a></td><td align="center" colspan="1" rowspan="1" style="width: 60%"><a href="index.html" shape="rect" title="Mini CRM Scout application"><img alt="Mini CRM Scout application" border="0" src="../../Images/home.gif"></img></a></td><td align="right" colspan="1" rowspan="1" style="width: 20%"><a href="05_add_a_search_form.html" shape="rect" title="Add a search form"><img alt="Next" border="0" src="../../Images/next.gif"></img></a></td></tr><tr><td align="left" colspan="1" rowspan="1" style="width: 20%">Set up SQL Service</td><td align="center" colspan="1" rowspan="1" style="width: 60%"></td><td align="right" colspan="1" rowspan="1" style="width: 20%">Add a search form</td></tr></table></body></html>
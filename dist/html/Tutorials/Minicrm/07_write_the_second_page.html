<?xml version='1.0' encoding='utf-8' ?><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/></head><body><table border="0" class="navigation" style="width: 100%;" summary="navigation"><tr><th align="center" colspan="3" rowspan="1" style="width: 100%;">Write the second page</th></tr><tr><td align="left" colspan="1" rowspan="1" style="width: 20%"><a href="06_add_a_form_to_edit_the_data.html" shape="rect" title="Add a form to edit the data"><img alt="Previous" border="0" src="../../Images/prev.gif"></img></a></td><td align="center" colspan="1" rowspan="1" style="width: 60%"></td><td align="right" colspan="1" rowspan="1" style="width: 20%"><a href="08_reorganize_the_tree.html" shape="rect" title="Reorganize the tree"><img alt="Next" border="0" src="../../Images/next.gif"></img></a></td></tr><tr><td align="left" colspan="1" rowspan="1" style="width: 20%">Add a form to edit the data</td><td align="center" colspan="1" rowspan="1" style="width: 60%"></td><td align="right" colspan="1" rowspan="1" style="width: 20%">Reorganize the tree</td></tr></table><p><div class="messagebox " style="background-color: #def3fe; border: 1px solid #c5d7e0; color: black; padding: 5px; margin: 1ex 0; min-height: 35px; padding-left: 45px; ">
<div style="float: left; margin-left: -40px;"><img width="35" border="0" src="../../Images/Note.png"/></div>
<div><b>Scout Tutorial</b><br/>This page belongs to the <a href="http://wiki.eclipse.org/Scout/Tutorial/3.8/Minicrm_Step-by-Step" title="Scout/Tutorial/3.8/Minicrm_Step-by-Step" target="doc_external">Minicrm Step-by-Step Tutorial</a>. It explains how create your second page in your project and use it as a child page for your first page. You need to have <a href="04_write_the_first_page.html" title="Scout/Tutorial/3.8/Minicrm/Write the first page">an existing table page</a> in order to continue.</div>
</div></p><p>We already have a page for companies. Quickly create a second top-level page for persons. Then reuse the same page as child page for the existing company page.</p><h2 id="A_new_table_page">A new table page</h2><p>Here are some notes to guide you:</p><p>Add <tt>getPersonTableData</tt> to the <b>StandardOutlineService</b>. Use <tt>SELECT PERSON_NR, LAST_NAME, FIRST_NAME FROM PERSON</tt> as your SQL statement.</p><p><img border="0" src="../../Images/Person.jpg"/></p><p>If you edited StandardOutlineService manually, make sure to add <tt>getPersonTableData</tt> to the interface <b>IStandardOutlineService</b> as well.</p><p><tt>getPersonTableData</tt> doesn't need a parameter, unless you want to create a <b>PersonSearchForm</b> as well; you don't need to do this for the tutorial, but it might be an excellent excercise</p><p>Add a <b>New Page...</b> to <i>Child Pages</i> of the <b>StandardOutline</b>; it uses the <i>AbstractPageWithTable</i> template, has the name <i>Person</i> and the type name <i>PersonTablePage</i></p><p>This is how the <b>StandardOutline has two child pages</b>, now:</p><pre class="source-java">protected void execCreateChildPages(Collection&lt;IPage&gt; pageList) throws ProcessingException {
  CompanyTablePage companyTablePage = new CompanyTablePage();
  pageList.add(companyTablePage);
  PersonTablePage personTablePage = new PersonTablePage();
  pageList.add(personTablePage);
}

</pre><p>This is how the <b>PersonTablePage loads data</b> from the outline service:</p><pre class="source-java">@Override
protected Object[][] execLoadTableData(SearchFilter filter) throws ProcessingException {
  return SERVICES.getService(IStandardOutlineService.class).getPersonTableData();
}

</pre><p>Add the following <b>columns</b> to the table inside the <i>PersonTablePage</i>:</p><table cellpadding="10"><tr><th>Table Column Template</th><th>Name</th><th>Type Name</th><th>Note</th></tr><tr><td>Long Column</td><td>(empty)</td><td>PersonNrColumn</td><td>not displayable</td></tr><tr><td>String Column</td><td>Last Name</td><td>LastNameColumn</td><td>width 200</td></tr><tr><td>String Column</td><td>First Name</td><td>FirstNameColumn</td><td>width 200</td></tr></table><p><img border="0" src="../../Images/Scout_Application_With_Person_Page.png"/></p><h2 id="Using_a_table_page_as_a_child_page_to_another_page">Using a table page as a child page to another page</h2><p>Return to the <b>CompanyTablePage</b>, click through to <i>Child Page</i>, and pick <b>Add Existing Page...</b> (we don't need to create a <i>new</i> page because we want to reuse the <i>person table page</i>), and pick <b>PersonTablePage</b>.</p><p>If you test your application now, you will see the complete list of people under every single company. What you're missing is a way to pass <b>the currently selected company to the SQL statement selecting the persons</b>.</p><p>This is what we want, basically:</p><ol><li>when the <i>child page</i> is created using <tt>execCreateChildPage</tt>, the value of the <i>CompanyNrColumn</i> acting as the parent is copied into a <b>variable on the PersonTablePage</b></li><li>the <i>PersonTablePage</i> uses the variable as an argument in its call to <b>getPersonTableData</b> on the <i>standard outline service</i> (this requires a change to the service implementation and to the service interface)</li><li><i>getPersonTableData</i> will then use the variable in its <tt>WHERE</tt> clause in order to select the appropriate persons</li></ol><p>First, return to the <b>PersonTablePage</b>, click through to <i>Variables</i>, and pick <b>New Property Bean...</b> from the context menu. Use <b>CompanyNr</b> for the <i>Name</i> and use <b>Long</b> for the <i>Bean Type</i>.</p><p><img border="0" src="../../Images/newPropertyBean_personTablePage.png"/></p><p><img border="0" src="../../Images/NewPropertyBean_1.png"/></p><p><img border="0" src="../../Images/Scout_Variable_For_Table_Page.png"/></p><p>But how do we set it? We need to set the <b>CompanyNr</b> when the <i>person table page</i> is being created <b>by its parent</b>. Return to the <b>CompanyTablePage</b> and click on the <b>Exec Create Child Page</b> link in the <i>Properties</i> view. Change it as follows:</p><pre class="source-java">@Override
protected IPage execCreateChildPage(ITableRow row) throws ProcessingException {
  PersonTablePage childPage = new PersonTablePage();
  childPage.setCompanyNr(getTable().getCompanyNrColumn().getValue(row));
  return childPage;
}

</pre><p>Notice how we get to use the <i>row</i> argument.</p><p>So now, as the <i>person table page</i> instance is created, it "knows" what its company is. It's stored in the <i>CompanyNr</i> variable. Now all we need to do is pass this number on to the <i>outline service</i>.</p><p>Go to the <b>PersonTablePage</b> and click on <b>Exec Load Table Data</b> in the <i>Properties</i> view. Change its definition as follows:</p><pre class="source-java">@Override
protected Object[][] execLoadTableData(SearchFilter filter) throws ProcessingException {
  return SERVICES.getService(IStandardOutlineService.class).getPersonTableData(getCompanyNr());
}

</pre><p>You'll note that this produces an error because the <i>outline service</i> is not yet ready to accept an extra parameter!</p><p><img border="0" src="../../Images/IStandardOutlineService.png"/></p><p>Return to the <b>StandardOutlineService</b> and click on <b>IStandardOutlineService</b> to change the interface for <i>getPersonTableData</i> as follows:</p><pre class="source-java">public Object[][] getPersonTableData(Long companyNr) throws ProcessingException;

</pre><p>Now go to the <b>StandardOutlineService</b> and change its definition of <i>getPersonTableData</i> as follows:</p><pre class="source-java">public Object[][] getPersonTableData(Long companyNr) throws ProcessingException {
  if (companyNr == null) {
    return SQL.select("SELECT PERSON_NR, LAST_NAME, FIRST_NAME FROM PERSON");
  } else {
    return SQL.select("" +
	"SELECT PERSON_NR, LAST_NAME, FIRST_NAME" +
	" FROM PERSON WHERE COMPANY_NR = :companyNr",
	new NVPair("companyNr", companyNr));
  }
}

</pre><p>Done!</p><p>Notice how we used <b>NVPair</b> to match a bind variable with a variable value. When we wrote our <a href="06_add_a_form_to_edit_the_data.html" title="Scout/Tutorial/3.8/Minicrm/Add_a_form_to_edit_the_data">first form</a> we just used the <b>form data</b> object to provide the bind variables, relying on the <i>naming conventions</i>. Here, we can no longer do that and need to be explicit about it.</p><p>Test it. Make sure you restart the server since you changed the services.</p><p><img border="0" src="../../Images/Scout-SecondpageDone.png"/></p><table border="0" class="navigation" style="width: 100%;" summary="navigation"><tr><td align="left" colspan="1" rowspan="1" style="width: 20%"><a href="06_add_a_form_to_edit_the_data.html" shape="rect" title="Add a form to edit the data"><img alt="Previous" border="0" src="../../Images/prev.gif"></img></a></td><td align="center" colspan="1" rowspan="1" style="width: 60%"><a href="index.html" shape="rect" title="Mini CRM Scout application"><img alt="Mini CRM Scout application" border="0" src="../../Images/home.gif"></img></a></td><td align="right" colspan="1" rowspan="1" style="width: 20%"><a href="08_reorganize_the_tree.html" shape="rect" title="Reorganize the tree"><img alt="Next" border="0" src="../../Images/next.gif"></img></a></td></tr><tr><td align="left" colspan="1" rowspan="1" style="width: 20%">Add a form to edit the data</td><td align="center" colspan="1" rowspan="1" style="width: 60%"></td><td align="right" colspan="1" rowspan="1" style="width: 20%">Reorganize the tree</td></tr></table></body></html>